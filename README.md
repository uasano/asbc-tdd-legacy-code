# asbc tdd legacy code sample. 

これは、ECサイトのカート部分のサービスを模したものです。

幾つかテストが用意されているものの「カートに1つも商品が入っていない状態で注文できてしまう」というバグが報告されている、という状態です。


まず、テストコードでカート内の商品が0件の時にどういう振る舞いをするかのテストがあるかを確認します。
テストコードがなかった為、 **カート内の商品が0件の時に注文した場合はApplicationExceptionが発生する** のテストを追加し、動作を確認します。

テストが期待する結果とは異なり、なんの例外も発生しませんでした。

ここをTDDのサイクルのとっかかりになるREDとして修正をスタートします。


次は、失敗しているテストを成功させるようにプロダクトコードを変更します。
CartServiceの orderメソッドが、カート内の商品件数をチェックせずに注文処理を実行しているので、注文処理の前に件数チェックを追加して件数が0の場合に例外を発生させるようにコードを変更します。

これでテストが成功したので、リファクタリングを検討する。

Cartを取得する一連の手続きをひとつのメソッドとして抽出し、currentCart メソッドとした。→このリファクタリングを実行した後にテストを実行して失敗しないことを確認する。
続いて、Cartの中に商品が入っているかの判定を CartServiceのメソッドがCartの内部のデータを取り出して判定してしまっていたので実装を隠ぺいするために判定メソッドをCartクラスへ移動させます。

Cartクラスにpublicメソッドが追加されたので、テストを追加する。

まずは件数が０の時に、hasNoItemsメソッドがtrueを返すことを確認するテストを書きます。
このテストが、REDになるので改めてCartクラスを見直します。